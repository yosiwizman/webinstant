# WebInstant Smoke Report
Timestamp: 2025-09-13T15:09:52.866Z

## Summary
- PASS - GET /api/health/config
- PASS - Resolved Supabase REST base
- PASS - Supabase REST reachability
- PASS - Table reachable: businesses
- PASS - Table reachable: website_previews
- PASS - Table reachable: email_logs
- PASS - Table reachable: email_queue
- PASS - Table reachable: email_templates
- PASS - Table reachable: api_usage
- PASS - Table reachable: operations_log
- PASS - Table reachable: ab_tests
- PASS - GET /api/admin/kpis
- FAIL - POST /api/admin/email/test
- FAIL - POST /api/generate-preview (batch 5)
- PASS - POST /api/generate-seo-media (limit 5)
- FAIL - Verify SEO (≥5) and hero media (≥5)
- FAIL - Verify previews count >= 5 (html_content)
- FAIL - operations_log contains correlationId (preview batch)
- PASS - email_templates reachable via REST
- PASS - email_queue reachable via REST

## Details
### GET /api/health/config
Status: PASS
```json
{
  "status": 200,
  "json": {
    "SUPABASE_URL": true,
    "SUPABASE_ANON_KEY": true,
    "SUPABASE_SERVICE_ROLE": true,
    "RESEND_API_KEY": true,
    "NEXT_PUBLIC_BASE_URL": true
  }
}
```
### Resolved Supabase REST base
Status: PASS
```json
{
  "supabaseUrl": "https://gidhshkekazxdbhlvoiw.supabase.co",
  "restBase": "https://gidhshkekazxdbhlvoiw.supabase.co/rest/v1",
  "suspect": false
}
```
### Supabase REST reachability
Status: PASS
```json
{
  "status": 401
}
```
### Table reachable: businesses
Status: PASS
```json
{
  "ok": true,
  "status": 401
}
```
### Table reachable: website_previews
Status: PASS
```json
{
  "ok": true,
  "status": 401
}
```
### Table reachable: email_logs
Status: PASS
```json
{
  "ok": true,
  "status": 401
}
```
### Table reachable: email_queue
Status: PASS
```json
{
  "ok": true,
  "status": 401
}
```
### Table reachable: email_templates
Status: PASS
```json
{
  "ok": true,
  "status": 401
}
```
### Table reachable: api_usage
Status: PASS
```json
{
  "ok": true,
  "status": 401
}
```
### Table reachable: operations_log
Status: PASS
```json
{
  "ok": true,
  "status": 401
}
```
### Table reachable: ab_tests
Status: PASS
```json
{
  "ok": true,
  "status": 401
}
```
### GET /api/admin/kpis
Status: PASS
```json
{
  "status": 200,
  "keys": [
    "emails_sent_today",
    "open_rate",
    "click_rate",
    "active_websites",
    "new_customers_today",
    "revenue",
    "recent_transactions"
  ]
}
```
### POST /api/admin/email/test
Status: FAIL
```json
{
  "status": 500,
  "hasResendKey": true
}
```
### POST /api/generate-preview (batch 5)
Status: FAIL
```json
{
  "status": 400,
  "body": {}
}
```
### POST /api/generate-seo-media (limit 5)
Status: PASS
```json
{
  "status": 200,
  "body": {
    "counts": {
      "updatedSeo": 0,
      "createdMedia": 0,
      "skipped": 0,
      "failed": 0
    },
    "correlationId": "de8fcb5f-d71e-4e02-be5e-12f7f93a7784"
  }
}
```
### Verify SEO (≥5) and hero media (≥5)
Status: FAIL
```json
{
  "seoCount": 0,
  "heroCount": 0,
  "correlationId": "de8fcb5f-d71e-4e02-be5e-12f7f93a7784"
}
```
### Verify previews count >= 5 (html_content)
Status: FAIL
```json
{
  "have": 0,
  "generated": 0,
  "skipped": 0,
  "failed": 0,
  "correlationId": ""
}
```
### operations_log contains correlationId (preview batch)
Status: FAIL
```json
{
  "error": "missing correlationId from response"
}
```
### email_templates reachable via REST
Status: PASS
```json
{
  "status": 401
}
```
### email_queue reachable via REST
Status: PASS
```json
{
  "status": 401
}
```

## Actionable Fixes

## Appendix
### health-config.json
```
{
  "SUPABASE_URL": true,
  "SUPABASE_ANON_KEY": true,
  "SUPABASE_SERVICE_ROLE": true,
  "RESEND_API_KEY": true,
  "NEXT_PUBLIC_BASE_URL": true
}
```
### supabase-index.txt
```
{"message":"Invalid API key","hint":"Double check your Supabase `anon` or `service_role` API key."}
```
### kpis.json
```
{
  "emails_sent_today": 0,
  "open_rate": 0,
  "click_rate": 0,
  "active_websites": 0,
  "new_customers_today": 0,
  "revenue": {
    "today": 0,
    "this_week": 0,
    "this_month": 0,
    "last_30_days_total": 0,
    "series_30d": [
      {
        "date": "2025-08-15",
        "amount": 0
      },
      {
        "date": "2025-08-16",
        "amount": 0
      },
      {
        "date": "2025-08-17",
        "amount": 0
      },
      {
        "date": "2025-08-18",
        "amount": 0
      },
      {
        "date": "2025-08-19",
        "amount": 0
      },
      {
        "date": "2025-08-20",
        "amount": 0
      },
      {
        "date": "2025-08-21",
        "amount": 0
      },
      {
        "date": "2025-08-22",
        "amount": 0
      },
      {
        "date": "2
…(truncated)
```

## PowerShell (reproduce)
```powershell
# From repo root
Set-Location "C:\\Users\\yosiw\\Desktop\\webinstant"

# Ensure env is present
if (!(Test-Path .env.local)) { Copy-Item .env.example .env.local }

# Install & build
npm ci
npm run build

# Start dev server in background
Start-Process powershell -ArgumentList 'npm run dev' -WindowStyle Minimized

# Wait for port 3000
$retries=30; while ($retries -gt 0) {
  try { (Invoke-WebRequest "http://localhost:3000/api/health/config" -UseBasicParsing -TimeoutSec 3) | Out-Null; break }
  catch { Start-Sleep -Seconds 1; $retries-- }
}

# Run smoke
npm run smoke -- --base http://localhost:3000

# Open the report
Invoke-Item ".\reports\smoke"
```